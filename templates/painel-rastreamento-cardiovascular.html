<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreamento Cardiovascular - Sistema APS</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#10b981',
                        cardiovascular: '#ef4444'
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- RemixIcon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">

    <!-- jsPDF - Biblioteca para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Script principal -->
    <script type="module" src="{{ url_for('static', filename='rastreamento_cardiovascular_script.js') }}" defer></script>

    <!-- Funções de renderização dos steps -->
    <script src="{{ url_for('static', filename='rastreamento_steps.js') }}" defer></script>

    <!-- Dashboard de acompanhamento -->
    <script src="{{ url_for('static', filename='dashboard_rastreamento.js') }}?v=16" defer></script>

    <!-- Não Hipertensos e Suspeitos de HAS -->
    <script src="{{ url_for('static', filename='dashboard_rastreamento_nao_hipertensos.js') }}" defer></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Estilos das abas do dashboard */
        .aba-btn {
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .aba-btn:hover {
            color: #374151;
            background-color: #f3f4f6;
        }

        /* Cores específicas para cada aba quando ativa */
        .aba-btn[data-aba="sem-triagem"].active {
            color: #6b7280;
            border-bottom-color: #6b7280;
            background-color: #f3f4f6;
        }

        .aba-btn[data-aba="em-triagem"].active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background-color: #dbeafe;
        }

        .aba-btn[data-aba="triagem-completa"].active {
            color: #16a34a;
            border-bottom-color: #16a34a;
            background-color: #dcfce7;
        }

        .aba-btn[data-aba="triagem-incompleta"].active {
            color: #ca8a04;
            border-bottom-color: #ca8a04;
            background-color: #fef9c3;
        }

        .aba-btn[data-aba="nao-hipertensos"].active {
            color: #16a34a;
            border-bottom-color: #16a34a;
            background-color: #dcfce7;
        }

        .aba-btn[data-aba="suspeitos-has"].active {
            color: #dc2626;
            border-bottom-color: #dc2626;
            background-color: #fee2e2;
        }

        .aba-conteudo {
            display: block;
        }

        .aba-conteudo.hidden {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">

    <!-- HEADER -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 flex items-center justify-center bg-red-100 rounded-xl">
                    <i class="ri-heart-pulse-line text-2xl text-red-600"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-red-600">Rastreamento Cardiovascular</h1>
                    <p class="text-sm text-gray-600">Hipertensão, Diabetes e Risco Cardiovascular</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600">{{ data_atual }}</span>
                <button class="text-gray-600 hover:text-gray-800">
                    <i class="ri-menu-line text-2xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- CONTAINER PRINCIPAL -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- TABS DE FASE DO RASTREAMENTO -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-4 px-6" aria-label="Tabs">
                    <button data-tab="hipertensao" class="tab-button active flex items-center px-4 py-4 text-sm font-medium border-b-2 border-red-500 text-red-600">
                        <i class="ri-heart-pulse-line mr-2"></i>
                        Rastreamento Hipertensão
                    </button>
                    <button data-tab="diabetes" class="tab-button flex items-center px-4 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="ri-test-tube-line mr-2"></i>
                        Rastreamento Diabetes
                        <span class="ml-2 px-2 py-0.5 text-xs bg-gray-200 text-gray-600 rounded">Em breve</span>
                    </button>
                    <button data-tab="risco" class="tab-button flex items-center px-4 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="ri-heart-line mr-2"></i>
                        Risco Cardiovascular
                        <span class="ml-2 px-2 py-0.5 text-xs bg-gray-200 text-gray-600 rounded">Em breve</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- TAB: RASTREAMENTO HIPERTENSÃO -->
        <div id="tab-content-hipertensao" class="tab-content">

            <!-- FILTROS -->
            <div id="area-filtros-dashboard" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="ri-filter-3-line mr-2"></i>Seleção de Família para Rastreamento
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Equipe</label>
                        <select id="filtro-equipe-dashboard" onchange="aplicarFiltrosDashboard()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Todas as equipes</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Microárea</label>
                        <select id="filtro-microarea-dashboard" onchange="aplicarFiltrosDashboard()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Todas as microáreas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Buscar por Endereço ou Nome</label>
                        <input type="text" id="filtro-busca-dashboard" placeholder="Digite o endereço ou nome do morador..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="aplicarFiltrosDashboard()" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition-colors">
                            <i class="ri-search-line mr-2"></i>Buscar
                        </button>
                    </div>
                </div>
            </div>

            <!-- CONTADORES DAS 6 CATEGORIAS -->
            <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">

                <!-- Sem Triagem -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-gray-400"
                     onclick="selecionarAba('sem-triagem')">
                    <div class="text-3xl font-bold text-gray-600" id="count-sem-triagem">0</div>
                    <div class="text-xs text-gray-600 mt-1 font-semibold">Sem Triagem</div>
                    <div class="text-xs text-gray-400 mt-1">Nenhum int. triado</div>
                </div>

                <!-- Em Triagem -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-blue-500"
                     onclick="selecionarAba('em-triagem')">
                    <div class="text-3xl font-bold text-blue-600" id="count-em-triagem">0</div>
                    <div class="text-xs text-blue-600 mt-1 font-semibold">Em Triagem</div>
                    <div class="text-xs text-gray-400 mt-1">≥1 int. triado</div>
                </div>

                <!-- Família - Triagem Completa -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-green-500"
                     onclick="selecionarAba('triagem-completa')">
                    <div class="text-3xl font-bold text-green-600" id="count-triagem-completa">0</div>
                    <div class="text-xs text-green-600 mt-1 font-semibold">Família - Triagem Completa</div>
                    <div class="text-xs text-gray-400 mt-1">Todos triados</div>
                </div>

                <!-- Família - Triagem Incompleta -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-yellow-500"
                     onclick="selecionarAba('triagem-incompleta')">
                    <div class="text-3xl font-bold text-yellow-600" id="count-triagem-incompleta">0</div>
                    <div class="text-xs text-yellow-600 mt-1 font-semibold">Família - Triagem Incompleta</div>
                    <div class="text-xs text-gray-400 mt-1">Algum não triado</div>
                </div>

                <!-- Não Hipertensos -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-teal-500"
                     onclick="selecionarAba('nao-hipertensos')">
                    <div class="text-3xl font-bold text-teal-600" id="count-nao-hipertensos">0</div>
                    <div class="text-xs text-teal-600 mt-1 font-semibold">Não Hipertensos</div>
                    <div class="text-xs text-gray-400 mt-1">Pacientes</div>
                </div>

                <!-- Hipertensos -->
                <div class="bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition-shadow border-b-4 border-red-500"
                     onclick="selecionarAba('hipertensos')">
                    <div class="text-3xl font-bold text-red-600" id="count-hipertensos">0</div>
                    <div class="text-xs text-red-600 mt-1 font-semibold">Hipertensos</div>
                    <div class="text-xs text-gray-400 mt-1">Pacientes</div>
                </div>

            </div>

            <!-- ABAS DE CONTEÚDO -->
            <div class="bg-white rounded-lg shadow-sm mb-6">
                <!-- Navegação das Abas -->
                <div class="border-b border-gray-200 px-6 pt-6">
                    <nav class="flex flex-wrap gap-2" id="abas-navegacao">
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg active" data-aba="sem-triagem">
                            <i class="ri-file-list-line mr-1"></i>Sem Triagem <span class="count-aba">(0)</span>
                        </button>
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg" data-aba="em-triagem">
                            <i class="ri-loader-4-line mr-1"></i>Em Triagem <span class="count-aba">(0)</span>
                        </button>
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg" data-aba="triagem-completa">
                            <i class="ri-checkbox-circle-line mr-1"></i>Triagem Completa <span class="count-aba">(0)</span>
                        </button>
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg" data-aba="triagem-incompleta">
                            <i class="ri-error-warning-line mr-1"></i>Triagem Incompleta <span class="count-aba">(0)</span>
                        </button>
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg" data-aba="nao-hipertensos">
                            <i class="ri-user-smile-line mr-1"></i>Não Hipertensos <span class="count-aba">(0)</span>
                        </button>
                        <button class="aba-btn px-4 py-2 text-sm font-medium rounded-t-lg" data-aba="suspeitos-has">
                            <i class="ri-alert-line mr-1"></i>Suspeitos de Hipertensão <span class="count-aba">(0)</span>
                        </button>
                    </nav>
                </div>

                <!-- Conteúdo das Abas -->
                <div class="p-6" id="conteudo-abas">
                    <div id="aba-sem-triagem" class="aba-conteudo">
                        <p class="text-gray-400 text-center py-8">Nenhuma família sem triagem</p>
                    </div>
                    <div id="aba-em-triagem" class="aba-conteudo hidden">
                        <p class="text-gray-400 text-center py-8">Nenhuma família em triagem</p>
                    </div>
                    <div id="aba-triagem-completa" class="aba-conteudo hidden">
                        <p class="text-gray-400 text-center py-8">Nenhuma família com triagem completa</p>
                    </div>
                    <div id="aba-triagem-incompleta" class="aba-conteudo hidden">
                        <p class="text-gray-400 text-center py-8">Nenhuma família com triagem incompleta</p>
                    </div>
                    <div id="aba-nao-hipertensos" class="aba-conteudo hidden">
                        <!-- Tabela de Não Hipertensos -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 rounded-lg text-xs">
                                <thead class="bg-green-50">
                                    <tr>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Nome</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">CNS/CPF</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Idade</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Sexo</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Domicílio</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Responsável</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Equipe</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Micro</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">PA</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Data</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Validade</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-green-900 uppercase tracking-tight border-b">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="lista-nao-hipertensos">
                                    <tr>
                                        <td colspan="12" class="px-4 py-8 text-center text-gray-400">
                                            Carregando...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Paginação -->
                        <div id="paginacao-nao-hipertensos" class="mt-4"></div>
                    </div>
                    <div id="aba-suspeitos-has" class="aba-conteudo hidden">
                        <!-- Tabela de Suspeitos de Hipertensão -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 rounded-lg text-xs">
                                <thead class="bg-red-50">
                                    <tr>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Nome</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">CNS/CPF</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Idade</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Sexo</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Domicílio</th>
                                        <th class="px-2 py-2 text-left text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Responsável</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Equipe</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Micro</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">PA</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Data</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Validade</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-red-900 uppercase tracking-tight border-b">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="lista-suspeitos-has">
                                    <tr>
                                        <td colspan="12" class="px-4 py-8 text-center text-gray-400">
                                            Carregando...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Paginação -->
                        <div id="paginacao-suspeitos-has" class="mt-4"></div>
                    </div>
                </div>
            </div>

            <!-- WIZARD DE RASTREAMENTO -->
            <div id="wizard-rastreamento" class="hidden">

                <!-- INDICADOR DE PROGRESSO -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-700">Progresso do Rastreamento</span>
                                <span class="text-sm font-medium text-gray-700"><span id="progress-percentage">0</span>%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progress-bar" class="bg-red-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- STEPS -->
                    <div class="flex items-center justify-between mt-4">
                        <div class="step-item active flex flex-col items-center" data-step="1">
                            <div class="w-10 h-10 rounded-full bg-red-600 text-white flex items-center justify-center mb-2">
                                <i class="ri-user-add-line"></i>
                            </div>
                            <span class="text-xs text-center">Selecionar<br>Integrantes</span>
                        </div>
                        <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                        <div class="step-item flex flex-col items-center" data-step="2">
                            <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center mb-2">
                                <i class="ri-file-pdf-line"></i>
                            </div>
                            <span class="text-xs text-center">Ficha de<br>Triagem</span>
                        </div>
                        <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                        <div class="step-item flex flex-col items-center" data-step="3">
                            <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center mb-2">
                                <i class="ri-stethoscope-line"></i>
                            </div>
                            <span class="text-xs text-center">Aferições<br>MRPA</span>
                        </div>
                        <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                        <div class="step-item flex flex-col items-center" data-step="4">
                            <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center mb-2">
                                <i class="ri-bar-chart-line"></i>
                            </div>
                            <span class="text-xs text-center">Análise<br>MRPA</span>
                        </div>
                        <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                        <div class="step-item flex flex-col items-center" data-step="5">
                            <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center mb-2">
                                <i class="ri-time-line"></i>
                            </div>
                            <span class="text-xs text-center">MRPA<br>5 Dias</span>
                        </div>
                        <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                        <div class="step-item flex flex-col items-center" data-step="6">
                            <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center mb-2">
                                <i class="ri-checkbox-circle-line"></i>
                            </div>
                            <span class="text-xs text-center">Resultado<br>Final</span>
                        </div>
                    </div>
                </div>

                <!-- ÁREA DE CONTEÚDO DO STEP ATUAL -->
                <div id="step-content" class="bg-white rounded-lg shadow-sm p-6">
                    <!-- Conteúdo dinâmico de cada step -->
                </div>

                <!-- BOTÕES DE NAVEGAÇÃO -->
                <div class="flex justify-between mt-6">
                    <button id="btn-voltar" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-md transition-colors hidden">
                        <i class="ri-arrow-left-line mr-2"></i>Voltar
                    </button>
                    <div class="flex-1"></div>
                    <button id="btn-proximo" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors">
                        Próximo<i class="ri-arrow-right-line ml-2"></i>
                    </button>
                    <button id="btn-finalizar" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors hidden">
                        <i class="ri-check-line mr-2"></i>Finalizar Rastreamento
                    </button>
                </div>
            </div>

        </div>

        <!-- TAB: DIABETES (Em breve) -->
        <div id="tab-content-diabetes" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-12 text-center">
                <i class="ri-test-tube-line text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-2xl font-semibold text-gray-700 mb-2">Rastreamento de Diabetes</h3>
                <p class="text-gray-500">Esta funcionalidade será implementada na Fase 2</p>
            </div>
        </div>

        <!-- TAB: RISCO CARDIOVASCULAR (Em breve) -->
        <div id="tab-content-risco" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-12 text-center">
                <i class="ri-heart-line text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-2xl font-semibold text-gray-700 mb-2">Rastreamento de Risco Cardiovascular</h3>
                <p class="text-gray-500">Esta funcionalidade será implementada na Fase 3</p>
            </div>
        </div>

    </div>

    <!-- MODAL: ENTRADA MANUAL DE RESULTADOS -->
    <div id="modal-entrada-manual" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="flex items-center justify-between p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Entrada Manual de Resultados</h3>
                    <button class="text-gray-400 hover:text-gray-600" onclick="fecharModalManual()">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <p class="text-sm text-gray-600 mb-4">
                        Use esta opção quando o paciente trouxer aferições realizadas por outros médicos ou em outros formatos (7 dias, 10 dias, 2x/dia, 5x/dia, etc).
                    </p>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Média PAS (mmHg)</label>
                            <input type="number" id="manual-pas" min="50" max="300" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Média PAD (mmHg)</label>
                            <input type="number" id="manual-pad" min="30" max="200" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Medição</label>
                        <input type="text" id="manual-tipo" placeholder="Ex: 7 dias 2x/dia" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Origem/Observações</label>
                        <textarea id="manual-obs" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Ex: Solicitado por cardiologista Dr. João"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Classificação</label>
                        <div class="flex gap-4">
                            <label class="flex items-center">
                                <input type="radio" name="manual-classificacao" value="HIPERTENSO" class="mr-2">
                                <span>Hipertenso</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="manual-classificacao" value="NAO_HIPERTENSO" class="mr-2">
                                <span>Não Hipertenso</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-3 p-6 border-t bg-gray-50">
                    <button onclick="fecharModalManual()" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button onclick="salvarResultadoManual()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTRO DE TRIAGEM (5 DIAS) -->
    <div id="modal-registro-triagem" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-7xl w-full my-8">
                <!-- Cabeçalho -->
                <div class="flex items-center justify-between p-6 border-b bg-blue-50">
                    <div>
                        <h3 class="text-xl font-bold text-blue-900">
                            <i class="ri-heart-pulse-line mr-2"></i>Registro de Triagem de Hipertensão
                        </h3>
                        <p class="text-sm text-blue-700 mt-1" id="info-familia-triagem">
                            <!-- Será preenchido via JavaScript -->
                        </p>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600" onclick="fecharModalTriagem()">
                        <i class="ri-close-line text-2xl"></i>
                    </button>
                </div>

                <!-- Conteúdo -->
                <div class="p-6">
                    <div class="mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <p class="text-sm text-yellow-800">
                            <i class="ri-information-line mr-1"></i>
                            <strong>Instruções:</strong> Digite no mínimo 3 aferições de pressão arterial (formato: 120/80).
                            O sistema calculará automaticamente a média e a classificação. Máximo de 5 aferições.
                        </p>
                    </div>

                    <div class="mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800">
                            <i class="ri-file-text-line mr-1"></i>
                            <strong>Diretriz Brasileira de Hipertensão Arterial - 2025:</strong> Define como hipertensão arterial PAS ≥130 e/ou PAD ≥80 através da Monitorização Residencial da Pressão Arterial. Em ambulatório PAS ≥140 e/ou PAD ≥90.
                        </p>
                    </div>

                    <!-- Tabela de Integrantes -->
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border border-gray-300 px-4 py-3 text-left text-sm font-semibold text-gray-700">
                                        Integrante
                                    </th>
                                    <th class="border border-gray-300 px-3 py-3 text-center text-sm font-semibold text-gray-700">
                                        Dia 1
                                    </th>
                                    <th class="border border-gray-300 px-3 py-3 text-center text-sm font-semibold text-gray-700">
                                        Dia 2
                                    </th>
                                    <th class="border border-gray-300 px-3 py-3 text-center text-sm font-semibold text-gray-700">
                                        Dia 3
                                    </th>
                                    <th class="border border-gray-300 px-3 py-3 text-center text-sm font-semibold text-gray-700">
                                        Dia 4
                                    </th>
                                    <th class="border border-gray-300 px-3 py-3 text-center text-sm font-semibold text-gray-700">
                                        Dia 5
                                    </th>
                                    <th class="border border-gray-300 px-4 py-3 text-center text-sm font-semibold text-gray-700">
                                        Média
                                    </th>
                                    <th class="border border-gray-300 px-4 py-3 text-center text-sm font-semibold text-gray-700">
                                        Classificação
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="tbody-integrantes-triagem">
                                <!-- Será preenchido via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Rodapé -->
                <div class="flex items-center justify-between px-6 py-4 border-t bg-gray-50">
                    <div class="text-sm text-gray-600">
                        <i class="ri-checkbox-line mr-1"></i>
                        <span id="contador-finalizados">0</span> de <span id="contador-total">0</span> integrantes com dados completos
                    </div>

                    <!-- Mensagem de salvamento parcial -->
                    <div id="msg-salvamento-parcial" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800">
                    </div>

                    <div class="flex gap-3">
                        <button onclick="fecharModalTriagem()"
                                class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">
                            <i class="ri-close-line mr-1"></i>Cancelar
                        </button>
                        <button onclick="salvarResultadosParciais()" id="btn-salvar-parcial"
                                class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled>
                            <i class="ri-save-line mr-1"></i>Salvar Resultados Parciais
                        </button>
                        <button onclick="finalizarTriagem()" id="btn-finalizar-triagem"
                                class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold">
                            <i class="ri-check-double-line mr-1"></i>Finalizar Triagem
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Visualizar Resultados da Triagem -->
    <div id="modal-visualizar-resultados" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between z-10">
                <div>
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="ri-eye-line mr-2"></i>Resultados da Triagem
                    </h3>
                    <p class="text-sm text-gray-600 mt-1" id="resultado-endereco"></p>
                </div>
                <button onclick="fecharModalResultados()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="ri-close-line"></i>
                </button>
            </div>

            <div class="p-6">
                <!-- Estatísticas -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-600" id="resultado-total-integrantes">0</div>
                        <div class="text-xs text-blue-700 mt-1">Total Integrantes</div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-600" id="resultado-total-triados">0</div>
                        <div class="text-xs text-green-700 mt-1">Triados</div>
                    </div>
                    <div class="bg-teal-50 border border-teal-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-teal-600" id="resultado-total-normais">0</div>
                        <div class="text-xs text-teal-700 mt-1">Normais</div>
                    </div>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-red-600" id="resultado-total-hipertensos">0</div>
                        <div class="text-xs text-red-700 mt-1">Hipertensos</div>
                    </div>
                </div>

                <!-- Status da Triagem -->
                <div class="mb-6 p-4 rounded-lg" id="resultado-status-container">
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="font-semibold text-gray-700">Status:</span>
                            <span id="resultado-status-badge" class="ml-2 px-3 py-1 rounded-full text-sm font-semibold"></span>
                        </div>
                        <div id="resultado-progress-container" class="hidden">
                            <div class="text-sm text-gray-600 mb-1">Progresso da Triagem</div>
                            <div class="w-64 bg-gray-200 rounded-full h-3">
                                <div id="resultado-progress-bar" class="bg-blue-600 h-3 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Integrantes -->
                <div class="space-y-4" id="resultado-integrantes-list">
                    <!-- Será preenchido via JavaScript -->
                </div>

                <!-- Botão para continuar triagem (se incompleta) -->
                <div id="resultado-btn-continuar-container" class="hidden mt-6 text-center">
                    <button onclick="continuarTriagemIncompleta()" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-semibold">
                        <i class="ri-edit-box-line mr-2"></i>Continuar Triagem
                    </button>
                </div>
            </div>

            <div class="sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-end">
                <button onclick="fecharModalResultados()" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md font-semibold">
                    <i class="ri-close-line mr-1"></i>Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Histórico de Triagens -->
    <div id="modal-historico-triagens" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full my-8">
            <!-- Cabeçalho -->
            <div class="flex items-center justify-between p-6 border-b bg-blue-50">
                <div>
                    <h3 class="text-xl font-bold text-blue-900">
                        <i class="ri-history-line mr-2"></i>Histórico de Triagens
                    </h3>
                    <p class="text-sm text-blue-700 mt-1" id="info-cidadao-historico">
                        <!-- Será preenchido via JavaScript -->
                    </p>
                </div>
                <button class="text-gray-400 hover:text-gray-600" onclick="fecharModalHistorico()">
                    <i class="ri-close-line text-2xl"></i>
                </button>
            </div>

            <!-- Conteúdo -->
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Data</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">PA Média</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">N° Aferições</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Resultado</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Equipe</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Microárea</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Status</th>
                            </tr>
                        </thead>
                        <tbody id="lista-historico-triagens">
                            <tr>
                                <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                                    Carregando histórico...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-end">
                <button onclick="fecharModalHistorico()" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md font-semibold">
                    <i class="ri-close-line mr-1"></i>Fechar
                </button>
            </div>
        </div>
    </div>

</body>

</html>
